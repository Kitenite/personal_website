{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useState, useRef, useEffect } from 'react';\nimport SignatureCanvas from 'react-signature-canvas';\nimport Button from '../../../components/Button';\nexport default function DrawingCanvas() {\n  // useStates\n  var sigCanvas = useRef({});\n\n  var _useState = useState(null),\n      imageURL = _useState[0],\n      setImageURL = _useState[1];\n\n  var _useState2 = useState(null),\n      resultArray = _useState2[0],\n      setResultArray = _useState2[1];\n\n  var _useState3 = useState(null),\n      height = _useState3[0],\n      setHeight = _useState3[1];\n\n  var _useState4 = useState(null),\n      width = _useState4[0],\n      setWidth = _useState4[1]; // Canvas Configuration\n\n\n  if (true) {\n    useEffect(function () {\n      return setHeight(document.children[0].clientHeight);\n    }, [document.children[0].clientHeight]);\n    useEffect(function () {\n      return setWidth(document.children[0].clientWidth);\n    }, [document.children[0].clientWidth]);\n  }\n\n  var canvasWidth = Math.min(height, width) / 2;\n  var brushSize = (canvasWidth / 30).toString(10); // Functions\n\n  var clearPad = function clearPad() {\n    sigCanvas.current.clear();\n    setImageURL(null);\n    setResultArray(null);\n  };\n\n  var submitPad = function submitPad() {\n    var submittedImage = sigCanvas.current.getTrimmedCanvas();\n    var result = processImage(submittedImage);\n    apiCall(result[1]);\n    setImageURL(result[0].toDataURL(\"image/png\"));\n  }; // Query our AI model\n\n\n  var apiCall = function apiCall(image_array) {\n    var model_url = '/api/v1/models/digit_model:predict';\n    var xhr = new XMLHttpRequest();\n    xhr.withCredentials = false; // get a callback when the server responds\n\n    xhr.addEventListener('load', function () {\n      // Get results and process\n      if (xhr.responseText) {\n        var reponse = JSON.parse(xhr.responseText);\n        processResult(reponse);\n      }\n    });\n    xhr.open('POST', model_url);\n    xhr.send(_JSON$stringify({\n      \"instances\": image_array\n    }));\n  };\n\n  var processResult = function processResult(reponse) {\n    var unsorted_array = reponse[\"predictions\"][0];\n    var sorted_array = Array(unsorted_array.length); // Get all results above 0.00%\n\n    for (var i = 0; i < unsorted_array.length; i++) {\n      var index = unsorted_array.indexOf(Math.max.apply(Math, _toConsumableArray(unsorted_array)));\n      var confidence = (unsorted_array[index] * 100).toFixed(2);\n\n      if (confidence > 0) {\n        sorted_array[i] = [index, confidence];\n        unsorted_array[index] = 0;\n      }\n    }\n\n    setResultArray(sorted_array);\n  };\n\n  var processImage = function processImage(img) {\n    // Scale image\n    var canvas = document.createElement('canvas');\n    var scale = Math.min(20 / img.width, 20 / img.height);\n    canvas.width = 28;\n    canvas.height = 28;\n    var cctx = canvas.getContext('2d');\n    cctx.imageSmoothingEnabled = true;\n    var scaled_width = img.width * scale;\n    var scaled_height = img.height * scale;\n    var dx = (28 - scaled_width) / 2;\n    var dy = (28 - scaled_height) / 2;\n    cctx.drawImage(img, dx, dy, scaled_width, scaled_height); // Turn into 2D array of 28x28\n\n    var image_array = Array(28);\n    var column_count = 0;\n    var row_count = 0;\n    var column_array = Array(28); // invert colors, make black and white and remove alpha\n\n    var imgData = cctx.getImageData(0, 0, canvas.width, canvas.height);\n    var i;\n\n    for (i = 0; i < imgData.data.length; i += 4) {\n      // Fill array\n      if (column_count >= 28) {\n        column_count = 0;\n        image_array[row_count] = column_array; // Reset column_array\n\n        column_array = Array(28);\n        row_count++;\n      }\n\n      if (imgData.data[i + 3] > 0) {\n        // Used to visualize image for debugging, can be discarded\n        imgData.data[i] = 255;\n        imgData.data[i + 1] = 255;\n        imgData.data[i + 2] = 255; // Convert to either 0 or 1\n\n        column_array[column_count] = 1;\n      } else {\n        // Used to visualize image for debugging, can be discarded\n        imgData.data[i] = 0;\n        imgData.data[i + 1] = 0;\n        imgData.data[i + 2] = 0; // Convert to either 0 or 1\n\n        column_array[column_count] = 0;\n      }\n\n      imgData.data[i + 3] = 255;\n      column_count++;\n    } // Lazy add final row empty\n\n\n    var final_row = Array(28);\n\n    for (var i = 0; i < final_row.length; i++) {\n      final_row[i] = 0;\n    }\n\n    image_array[27] = final_row; // Print out array\n    // console.log(image_array);\n\n    cctx.putImageData(imgData, 0, 0);\n    var newImage = canvas;\n    return [newImage, image_array];\n  };\n\n  var result_graph = function result_graph(resultArray) {\n    return __jsx(\"div\", null, resultArray.map(function (result, index) {\n      return __jsx(\"p\", {\n        key: index\n      }, \"Number: \", result[0], \" \", __jsx(\"br\", null), \"Confidence: \", result[1], \"%\");\n    }));\n  };\n\n  return __jsx(\"div\", null, __jsx(SignatureCanvas, {\n    ref: sigCanvas,\n    penColor: \"black\",\n    velocityFilterWeight: \"0\",\n    maxWidth: brushSize,\n    dotSize: \"0\",\n    canvasProps: {\n      width: canvasWidth,\n      height: canvasWidth,\n      className: 'signatureCanvas'\n    }\n  }), __jsx(\"div\", {\n    className: \"jsx-206385541\" + \" \" + \"button-wrapper\"\n  }, __jsx(Button, {\n    className: \"button\",\n    onClick: clearPad,\n    isClear: \"true\"\n  }, \"clear\"), __jsx(Button, {\n    className: \"button\",\n    onClick: submitPad\n  }, \"submit\"), __jsx(_JSXStyle, {\n    id: \"206385541\"\n  }, \".jsx-206385541{padding-left:5vh;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9raWV0aG8vUmVwb3Mvc3R1ZmZieWtpZXQuY29tL3BhZ2VzL3Byb2plY3RzL2NvbXBvbmVudHMvRHJhd2luZ0NhbnZhcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUErSm9CLEFBR1UsaUJBQUMiLCJmaWxlIjoiL1VzZXJzL2tpZXRoby9SZXBvcy9zdHVmZmJ5a2lldC5jb20vcGFnZXMvcHJvamVjdHMvY29tcG9uZW50cy9EcmF3aW5nQ2FudmFzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHt1c2VTdGF0ZSwgdXNlUmVmLCB1c2VFZmZlY3R9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBTaWduYXR1cmVDYW52YXMgZnJvbSAncmVhY3Qtc2lnbmF0dXJlLWNhbnZhcydcbmltcG9ydCBCdXR0b24gZnJvbSAnLi4vLi4vLi4vY29tcG9uZW50cy9CdXR0b24nO1xuXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIERyYXdpbmdDYW52YXMoKXtcbiAgLy8gdXNlU3RhdGVzXG4gIGNvbnN0IHNpZ0NhbnZhcyA9IHVzZVJlZih7fSk7XG4gIGNvbnN0IFtpbWFnZVVSTCwgc2V0SW1hZ2VVUkxdID0gdXNlU3RhdGUobnVsbCk7XG4gIGNvbnN0IFtyZXN1bHRBcnJheSwgc2V0UmVzdWx0QXJyYXldID0gdXNlU3RhdGUobnVsbCk7XG4gIGNvbnN0IFtoZWlnaHQsIHNldEhlaWdodF0gPSB1c2VTdGF0ZShudWxsKVxuICBjb25zdCBbd2lkdGgsIHNldFdpZHRoXSA9IHVzZVN0YXRlKG51bGwpXG4gIC8vIENhbnZhcyBDb25maWd1cmF0aW9uXG5cbiAgaWYgKHByb2Nlc3MuYnJvd3Nlcikge1xuICAgIHVzZUVmZmVjdCgoKSA9PiBzZXRIZWlnaHQoZG9jdW1lbnQuY2hpbGRyZW5bMF0uY2xpZW50SGVpZ2h0KSwgW2RvY3VtZW50LmNoaWxkcmVuWzBdLmNsaWVudEhlaWdodF0pXG4gICAgdXNlRWZmZWN0KCgpID0+IHNldFdpZHRoKGRvY3VtZW50LmNoaWxkcmVuWzBdLmNsaWVudFdpZHRoKSwgW2RvY3VtZW50LmNoaWxkcmVuWzBdLmNsaWVudFdpZHRoXSlcbiAgfVxuICBjb25zdCBjYW52YXNXaWR0aCA9ICBNYXRoLm1pbihoZWlnaHQsIHdpZHRoKS8yO1xuICBjb25zdCBicnVzaFNpemUgPSAoY2FudmFzV2lkdGgvMzApLnRvU3RyaW5nKDEwKTtcblxuICAvLyBGdW5jdGlvbnNcbiAgY29uc3QgY2xlYXJQYWQgPSAoKSA9PiB7XG4gICAgc2lnQ2FudmFzLmN1cnJlbnQuY2xlYXIoKTtcbiAgICBzZXRJbWFnZVVSTChudWxsKTtcbiAgICBzZXRSZXN1bHRBcnJheShudWxsKTtcbiAgfTtcbiAgY29uc3Qgc3VibWl0UGFkID0gKCkgPT4ge1xuICAgIGxldCBzdWJtaXR0ZWRJbWFnZSA9IHNpZ0NhbnZhcy5jdXJyZW50LmdldFRyaW1tZWRDYW52YXMoKTtcbiAgICBsZXQgcmVzdWx0ID0gcHJvY2Vzc0ltYWdlKHN1Ym1pdHRlZEltYWdlKVxuICAgIGFwaUNhbGwocmVzdWx0WzFdKTtcbiAgICBzZXRJbWFnZVVSTChyZXN1bHRbMF0udG9EYXRhVVJMKFwiaW1hZ2UvcG5nXCIpKTtcbiAgfTtcblxuICAvLyBRdWVyeSBvdXIgQUkgbW9kZWxcbiAgY29uc3QgYXBpQ2FsbCA9IChpbWFnZV9hcnJheSkgPT4ge1xuICAgIGNvbnN0IG1vZGVsX3VybCA9ICcvYXBpL3YxL21vZGVscy9kaWdpdF9tb2RlbDpwcmVkaWN0JztcbiAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgeGhyLndpdGhDcmVkZW50aWFscyA9IGZhbHNlO1xuICAgIC8vIGdldCBhIGNhbGxiYWNrIHdoZW4gdGhlIHNlcnZlciByZXNwb25kc1xuICAgIHhoci5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4ge1xuICAgICAgLy8gR2V0IHJlc3VsdHMgYW5kIHByb2Nlc3NcbiAgICAgIGlmICh4aHIucmVzcG9uc2VUZXh0KXtcbiAgICAgICAgbGV0IHJlcG9uc2UgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xuICAgICAgICBwcm9jZXNzUmVzdWx0KHJlcG9uc2UpXG4gICAgICB9XG4gICAgfSk7XG4gICAgeGhyLm9wZW4oJ1BPU1QnLCBtb2RlbF91cmwpO1xuICAgIHhoci5zZW5kKEpTT04uc3RyaW5naWZ5KHsgXCJpbnN0YW5jZXNcIjogaW1hZ2VfYXJyYXkgfSkpO1xuICB9XG5cbiAgY29uc3QgcHJvY2Vzc1Jlc3VsdCA9IChyZXBvbnNlKSA9PiB7XG4gICAgbGV0IHVuc29ydGVkX2FycmF5ID0gcmVwb25zZVtcInByZWRpY3Rpb25zXCJdWzBdO1xuICAgIGxldCBzb3J0ZWRfYXJyYXkgPSBBcnJheSh1bnNvcnRlZF9hcnJheS5sZW5ndGgpO1xuICAgIC8vIEdldCBhbGwgcmVzdWx0cyBhYm92ZSAwLjAwJVxuICAgIGZvciAodmFyIGkgPSAwOyBpPCB1bnNvcnRlZF9hcnJheS5sZW5ndGg7IGkrKyl7XG4gICAgICBsZXQgaW5kZXggPSB1bnNvcnRlZF9hcnJheS5pbmRleE9mKE1hdGgubWF4KC4uLnVuc29ydGVkX2FycmF5KSk7XG4gICAgICBsZXQgY29uZmlkZW5jZSA9ICh1bnNvcnRlZF9hcnJheVtpbmRleF0qMTAwKS50b0ZpeGVkKDIpXG4gICAgICBpZiAoY29uZmlkZW5jZSA+IDApe1xuICAgICAgICBzb3J0ZWRfYXJyYXlbaV0gPSBbaW5kZXgsIGNvbmZpZGVuY2VdO1xuICAgICAgICB1bnNvcnRlZF9hcnJheVtpbmRleF0gPSAwO1xuICAgICAgfVxuICAgIH1cbiAgICBzZXRSZXN1bHRBcnJheShzb3J0ZWRfYXJyYXkpO1xuICB9XG4gIGNvbnN0IHByb2Nlc3NJbWFnZSA9IChpbWcpID0+IHtcbiAgICAvLyBTY2FsZSBpbWFnZVxuICAgIGNvbnN0IGNhbnZhcyA9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgY29uc3Qgc2NhbGUgPSBNYXRoLm1pbigyMC9pbWcud2lkdGgsIDIwL2ltZy5oZWlnaHQpO1xuICAgIGNhbnZhcy53aWR0aCA9IDI4O1xuICAgIGNhbnZhcy5oZWlnaHQgPSAyODtcbiAgICBjb25zdCBjY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgY2N0eC5pbWFnZVNtb290aGluZ0VuYWJsZWQgPSB0cnVlO1xuICAgIGNvbnN0IHNjYWxlZF93aWR0aCA9IGltZy53aWR0aCpzY2FsZTtcbiAgICBjb25zdCBzY2FsZWRfaGVpZ2h0ID0gaW1nLmhlaWdodCpzY2FsZTtcbiAgICBjb25zdCBkeCA9ICgyOCAtIHNjYWxlZF93aWR0aCkvMjtcbiAgICBjb25zdCBkeSA9ICgyOCAtIHNjYWxlZF9oZWlnaHQpLzI7XG4gICAgY2N0eC5kcmF3SW1hZ2UoaW1nLCBkeCwgZHksIHNjYWxlZF93aWR0aCwgc2NhbGVkX2hlaWdodCk7XG5cblxuICAgIC8vIFR1cm4gaW50byAyRCBhcnJheSBvZiAyOHgyOFxuICAgIGNvbnN0IGltYWdlX2FycmF5ID0gQXJyYXkoMjgpO1xuICAgIHZhciBjb2x1bW5fY291bnQgPSAwXG4gICAgdmFyIHJvd19jb3VudCA9IDBcbiAgICB2YXIgY29sdW1uX2FycmF5ID0gQXJyYXkoMjgpO1xuXG4gICAgLy8gaW52ZXJ0IGNvbG9ycywgbWFrZSBibGFjayBhbmQgd2hpdGUgYW5kIHJlbW92ZSBhbHBoYVxuICAgIHZhciBpbWdEYXRhID0gY2N0eC5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcbiAgICB2YXIgaTtcbiAgICBmb3IgKGkgPSAwOyBpIDwgaW1nRGF0YS5kYXRhLmxlbmd0aDsgaSArPSA0KSB7XG5cbiAgICAgIC8vIEZpbGwgYXJyYXlcbiAgICAgIGlmIChjb2x1bW5fY291bnQgPj0gMjgpe1xuICAgICAgICBjb2x1bW5fY291bnQgPSAwO1xuICAgICAgICBpbWFnZV9hcnJheVtyb3dfY291bnRdID0gY29sdW1uX2FycmF5O1xuICAgICAgICAvLyBSZXNldCBjb2x1bW5fYXJyYXlcbiAgICAgICAgY29sdW1uX2FycmF5ID0gQXJyYXkoMjgpO1xuICAgICAgICByb3dfY291bnQrKztcbiAgICAgIH1cblxuICAgICAgaWYgKGltZ0RhdGEuZGF0YVtpICsgM10gPiAwKXtcbiAgICAgICAgLy8gVXNlZCB0byB2aXN1YWxpemUgaW1hZ2UgZm9yIGRlYnVnZ2luZywgY2FuIGJlIGRpc2NhcmRlZFxuICAgICAgICBpbWdEYXRhLmRhdGFbaV0gPSAyNTU7XG4gICAgICAgIGltZ0RhdGEuZGF0YVtpKzFdID0gMjU1O1xuICAgICAgICBpbWdEYXRhLmRhdGFbaSsyXSA9IDI1NTtcbiAgICAgICAgLy8gQ29udmVydCB0byBlaXRoZXIgMCBvciAxXG4gICAgICAgIGNvbHVtbl9hcnJheVtjb2x1bW5fY291bnRdID0gMTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFVzZWQgdG8gdmlzdWFsaXplIGltYWdlIGZvciBkZWJ1Z2dpbmcsIGNhbiBiZSBkaXNjYXJkZWRcbiAgICAgICAgaW1nRGF0YS5kYXRhW2ldID0gMDtcbiAgICAgICAgaW1nRGF0YS5kYXRhW2krMV0gPSAwO1xuICAgICAgICBpbWdEYXRhLmRhdGFbaSsyXSA9IDA7XG4gICAgICAgIC8vIENvbnZlcnQgdG8gZWl0aGVyIDAgb3IgMVxuICAgICAgICBjb2x1bW5fYXJyYXlbY29sdW1uX2NvdW50XSA9IDA7XG4gICAgICB9XG4gICAgICBpbWdEYXRhLmRhdGFbaSArIDNdID0gMjU1O1xuICAgICAgY29sdW1uX2NvdW50Kys7XG4gICAgfVxuXG4gICAgLy8gTGF6eSBhZGQgZmluYWwgcm93IGVtcHR5XG4gICAgdmFyIGZpbmFsX3JvdyA9IEFycmF5KDI4KTtcbiAgICBmb3IgKHZhciBpID0wOyBpPCBmaW5hbF9yb3cubGVuZ3RoOyBpKyspe1xuICAgICAgZmluYWxfcm93W2ldID0gMDtcbiAgICB9XG4gICAgaW1hZ2VfYXJyYXlbMjddID0gZmluYWxfcm93O1xuXG4gICAgLy8gUHJpbnQgb3V0IGFycmF5XG4gICAgLy8gY29uc29sZS5sb2coaW1hZ2VfYXJyYXkpO1xuXG4gICAgY2N0eC5wdXRJbWFnZURhdGEoaW1nRGF0YSwgMCwgMCk7XG4gICAgbGV0IG5ld0ltYWdlID0gY2FudmFzO1xuICAgIHJldHVybiBbbmV3SW1hZ2UsIGltYWdlX2FycmF5XTtcbiAgfVxuXG4gIGNvbnN0IHJlc3VsdF9ncmFwaCA9IChyZXN1bHRBcnJheSkgPT4ge1xuICAgIHJldHVybig8ZGl2PlxuICAgICAge3Jlc3VsdEFycmF5Lm1hcCgocmVzdWx0LCBpbmRleCkgPT4gKFxuICAgICAgICA8cCBrZXk9e2luZGV4fT5OdW1iZXI6IHtyZXN1bHRbMF19IDxici8+Q29uZmlkZW5jZToge3Jlc3VsdFsxXX0lPC9wPlxuICAgICkpfVxuICAgIDwvZGl2PlxuICAgIClcbiAgfVxuXG4gIHJldHVybihcbiAgICA8ZGl2PlxuICAgICAgPFNpZ25hdHVyZUNhbnZhc1xuICAgICAgICAgICAgcmVmID0ge3NpZ0NhbnZhc31cbiAgICAgICAgICAgIHBlbkNvbG9yPSdibGFjaydcbiAgICAgICAgICAgIHZlbG9jaXR5RmlsdGVyV2VpZ2h0PScwJ1xuICAgICAgICAgICAgbWF4V2lkdGg9IHticnVzaFNpemV9XG4gICAgICAgICAgICBkb3RTaXplPScwJ1xuICAgICAgICAgICAgY2FudmFzUHJvcHM9e3tcbiAgICAgICAgICAgICAgd2lkdGg6IGNhbnZhc1dpZHRoLFxuICAgICAgICAgICAgICBoZWlnaHQ6IGNhbnZhc1dpZHRoLFxuICAgICAgICAgICAgICBjbGFzc05hbWU6ICdzaWduYXR1cmVDYW52YXMnXG4gICAgICAgICAgICB9fSAvPlxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJidXR0b24td3JhcHBlclwiPlxuICAgICAgICA8QnV0dG9uIGNsYXNzTmFtZT1cImJ1dHRvblwiIG9uQ2xpY2s9e2NsZWFyUGFkfSBpc0NsZWFyPVwidHJ1ZVwiPmNsZWFyPC9CdXR0b24+XG4gICAgICAgIDxCdXR0b24gY2xhc3NOYW1lPVwiYnV0dG9uXCIgb25DbGljaz17c3VibWl0UGFkfT5zdWJtaXQ8L0J1dHRvbj5cbiAgICAgICAgPHN0eWxlIGpzeD57YFxuICAgICAgICAgIHBhZGRpbmctbGVmdDo1dmhcbiAgICAgICAgICBgfTwvc3R5bGU+XG4gICAgICA8L2Rpdj5cbiAgICAgIHtyZXN1bHRBcnJheSA/IChcbiAgICAgICAgPD5cbiAgICAgICAgICA8YT5Zb3VyIHJlc3VsdDogPC9hPlxuICAgICAgICAgIDxhPntyZXN1bHRfZ3JhcGgocmVzdWx0QXJyYXkpfTwvYT5cbiAgICAgICAgPC8+XG4gICAgICApIDogbnVsbH1cblxuICAgICAge2ltYWdlVVJMID8gKFxuICAgICAgICA8PlxuICAgICAgICAgIDxhPlByb2Nlc3NlZCBEaWdpdDwvYT5cbiAgICAgICAgICA8aW1nXG4gICAgICAgICAgICBzcmM9e2ltYWdlVVJMfVxuICAgICAgICAgICAgYWx0PVwibXkgc2lnbmF0dXJlXCJcbiAgICAgICAgICAgIHN0eWxlPXt7XG4gICAgICAgICAgICAgIGRpc3BsYXk6IFwiYmxvY2tcIixcbiAgICAgICAgICAgICAgbWFyZ2luOiBcIjAgYXV0b1wiLFxuICAgICAgICAgICAgICBib3JkZXI6IFwiMXB4IHNvbGlkIGJsYWNrXCIsXG4gICAgICAgICAgICAgIHdpZHRoOiBcIjE1MHB4XCJcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgLz5cbiAgICAgICAgPC8+XG4gICAgICApIDogbnVsbH1cbiAgICA8L2Rpdj5cbiAgKVxufVxuIl19 */\\n/*@ sourceURL=/Users/kietho/Repos/stuffbykiet.com/pages/projects/components/DrawingCanvas.js */\")), resultArray ? __jsx(React.Fragment, null, __jsx(\"a\", null, \"Your result: \"), __jsx(\"a\", null, result_graph(resultArray))) : null, imageURL ? __jsx(React.Fragment, null, __jsx(\"a\", null, \"Processed Digit\"), __jsx(\"img\", {\n    src: imageURL,\n    alt: \"my signature\",\n    style: {\n      display: \"block\",\n      margin: \"0 auto\",\n      border: \"1px solid black\",\n      width: \"150px\"\n    }\n  })) : null);\n}","map":{"version":3,"sources":["/Users/kietho/Repos/stuffbykiet.com/pages/projects/components/DrawingCanvas.js"],"names":["useState","useRef","useEffect","SignatureCanvas","Button","DrawingCanvas","sigCanvas","imageURL","setImageURL","resultArray","setResultArray","height","setHeight","width","setWidth","document","children","clientHeight","clientWidth","canvasWidth","Math","min","brushSize","toString","clearPad","current","clear","submitPad","submittedImage","getTrimmedCanvas","result","processImage","apiCall","toDataURL","image_array","model_url","xhr","XMLHttpRequest","withCredentials","addEventListener","responseText","reponse","JSON","parse","processResult","open","send","unsorted_array","sorted_array","Array","length","i","index","indexOf","max","confidence","toFixed","img","canvas","createElement","scale","cctx","getContext","imageSmoothingEnabled","scaled_width","scaled_height","dx","dy","drawImage","column_count","row_count","column_array","imgData","getImageData","data","final_row","putImageData","newImage","result_graph","map","className","display","margin","border"],"mappings":"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","sourcesContent":["import {useState, useRef, useEffect} from 'react';\nimport SignatureCanvas from 'react-signature-canvas'\nimport Button from '../../../components/Button';\n\n\nexport default function DrawingCanvas(){\n  // useStates\n  const sigCanvas = useRef({});\n  const [imageURL, setImageURL] = useState(null);\n  const [resultArray, setResultArray] = useState(null);\n  const [height, setHeight] = useState(null)\n  const [width, setWidth] = useState(null)\n  // Canvas Configuration\n\n  if (process.browser) {\n    useEffect(() => setHeight(document.children[0].clientHeight), [document.children[0].clientHeight])\n    useEffect(() => setWidth(document.children[0].clientWidth), [document.children[0].clientWidth])\n  }\n  const canvasWidth =  Math.min(height, width)/2;\n  const brushSize = (canvasWidth/30).toString(10);\n\n  // Functions\n  const clearPad = () => {\n    sigCanvas.current.clear();\n    setImageURL(null);\n    setResultArray(null);\n  };\n  const submitPad = () => {\n    let submittedImage = sigCanvas.current.getTrimmedCanvas();\n    let result = processImage(submittedImage)\n    apiCall(result[1]);\n    setImageURL(result[0].toDataURL(\"image/png\"));\n  };\n\n  // Query our AI model\n  const apiCall = (image_array) => {\n    const model_url = '/api/v1/models/digit_model:predict';\n    var xhr = new XMLHttpRequest();\n    xhr.withCredentials = false;\n    // get a callback when the server responds\n    xhr.addEventListener('load', () => {\n      // Get results and process\n      if (xhr.responseText){\n        let reponse = JSON.parse(xhr.responseText);\n        processResult(reponse)\n      }\n    });\n    xhr.open('POST', model_url);\n    xhr.send(JSON.stringify({ \"instances\": image_array }));\n  }\n\n  const processResult = (reponse) => {\n    let unsorted_array = reponse[\"predictions\"][0];\n    let sorted_array = Array(unsorted_array.length);\n    // Get all results above 0.00%\n    for (var i = 0; i< unsorted_array.length; i++){\n      let index = unsorted_array.indexOf(Math.max(...unsorted_array));\n      let confidence = (unsorted_array[index]*100).toFixed(2)\n      if (confidence > 0){\n        sorted_array[i] = [index, confidence];\n        unsorted_array[index] = 0;\n      }\n    }\n    setResultArray(sorted_array);\n  }\n  const processImage = (img) => {\n    // Scale image\n    const canvas =document.createElement('canvas');\n    const scale = Math.min(20/img.width, 20/img.height);\n    canvas.width = 28;\n    canvas.height = 28;\n    const cctx = canvas.getContext('2d');\n    cctx.imageSmoothingEnabled = true;\n    const scaled_width = img.width*scale;\n    const scaled_height = img.height*scale;\n    const dx = (28 - scaled_width)/2;\n    const dy = (28 - scaled_height)/2;\n    cctx.drawImage(img, dx, dy, scaled_width, scaled_height);\n\n\n    // Turn into 2D array of 28x28\n    const image_array = Array(28);\n    var column_count = 0\n    var row_count = 0\n    var column_array = Array(28);\n\n    // invert colors, make black and white and remove alpha\n    var imgData = cctx.getImageData(0, 0, canvas.width, canvas.height);\n    var i;\n    for (i = 0; i < imgData.data.length; i += 4) {\n\n      // Fill array\n      if (column_count >= 28){\n        column_count = 0;\n        image_array[row_count] = column_array;\n        // Reset column_array\n        column_array = Array(28);\n        row_count++;\n      }\n\n      if (imgData.data[i + 3] > 0){\n        // Used to visualize image for debugging, can be discarded\n        imgData.data[i] = 255;\n        imgData.data[i+1] = 255;\n        imgData.data[i+2] = 255;\n        // Convert to either 0 or 1\n        column_array[column_count] = 1;\n      } else {\n        // Used to visualize image for debugging, can be discarded\n        imgData.data[i] = 0;\n        imgData.data[i+1] = 0;\n        imgData.data[i+2] = 0;\n        // Convert to either 0 or 1\n        column_array[column_count] = 0;\n      }\n      imgData.data[i + 3] = 255;\n      column_count++;\n    }\n\n    // Lazy add final row empty\n    var final_row = Array(28);\n    for (var i =0; i< final_row.length; i++){\n      final_row[i] = 0;\n    }\n    image_array[27] = final_row;\n\n    // Print out array\n    // console.log(image_array);\n\n    cctx.putImageData(imgData, 0, 0);\n    let newImage = canvas;\n    return [newImage, image_array];\n  }\n\n  const result_graph = (resultArray) => {\n    return(<div>\n      {resultArray.map((result, index) => (\n        <p key={index}>Number: {result[0]} <br/>Confidence: {result[1]}%</p>\n    ))}\n    </div>\n    )\n  }\n\n  return(\n    <div>\n      <SignatureCanvas\n            ref = {sigCanvas}\n            penColor='black'\n            velocityFilterWeight='0'\n            maxWidth= {brushSize}\n            dotSize='0'\n            canvasProps={{\n              width: canvasWidth,\n              height: canvasWidth,\n              className: 'signatureCanvas'\n            }} />\n      <div className=\"button-wrapper\">\n        <Button className=\"button\" onClick={clearPad} isClear=\"true\">clear</Button>\n        <Button className=\"button\" onClick={submitPad}>submit</Button>\n        <style jsx>{`\n          padding-left:5vh\n          `}</style>\n      </div>\n      {resultArray ? (\n        <>\n          <a>Your result: </a>\n          <a>{result_graph(resultArray)}</a>\n        </>\n      ) : null}\n\n      {imageURL ? (\n        <>\n          <a>Processed Digit</a>\n          <img\n            src={imageURL}\n            alt=\"my signature\"\n            style={{\n              display: \"block\",\n              margin: \"0 auto\",\n              border: \"1px solid black\",\n              width: \"150px\"\n            }}\n          />\n        </>\n      ) : null}\n    </div>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}